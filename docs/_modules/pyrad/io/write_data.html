
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pyrad.io.write_data &#8212; pyrad 0.1.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pyrad 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyrad.io.write_data</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">pyrad.io.write_data</span>
<span class="sd">====================</span>

<span class="sd">Functions for writing pyrad output data</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    write_proc_periods</span>
<span class="sd">    write_fixed_angle</span>
<span class="sd">    write_ts_lightning</span>
<span class="sd">    send_msg</span>
<span class="sd">    write_alarm_msg</span>
<span class="sd">    write_last_state</span>
<span class="sd">    write_smn</span>
<span class="sd">    write_trt_info</span>
<span class="sd">    write_trt_cell_data</span>
<span class="sd">    write_trt_thundertracking_data</span>
<span class="sd">    write_trt_cell_scores</span>
<span class="sd">    write_trt_cell_lightning</span>
<span class="sd">    write_rhi_profile</span>
<span class="sd">    write_field_coverage</span>
<span class="sd">    write_cdf</span>
<span class="sd">    write_histogram</span>
<span class="sd">    write_quantiles</span>
<span class="sd">    write_ts_polar_data</span>
<span class="sd">    write_ts_ml</span>
<span class="sd">    write_ts_cum</span>
<span class="sd">    write_monitoring_ts</span>
<span class="sd">    write_excess_gates</span>
<span class="sd">    write_intercomp_scores_ts</span>
<span class="sd">    write_colocated_gates</span>
<span class="sd">    write_colocated_data</span>
<span class="sd">    write_colocated_data_time_avg</span>
<span class="sd">    write_sun_hits</span>
<span class="sd">    write_sun_retrieval</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>
<span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">email.message</span> <span class="k">import</span> <span class="n">EmailMessage</span>
<span class="kn">import</span> <span class="nn">fcntl</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pyart.config</span> <span class="k">import</span> <span class="n">get_fillvalue</span>

<span class="kn">from</span> <span class="nn">.io_aux</span> <span class="k">import</span> <span class="n">generate_field_name_str</span>



<div class="viewcode-block" id="write_proc_periods"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_proc_periods">[docs]</a><span class="k">def</span> <span class="nf">write_proc_periods</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes an output file containing start and stop times of periods to</span>
<span class="sd">    process</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start_times, end_times : datetime object</span>
<span class="sd">        The starting and ending times of the periods</span>
<span class="sd">    fname : str</span>
<span class="sd">        The name of the file where to write</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file containing the content</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;end_time&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">field_names</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">end_times</span><span class="p">):</span>
            <span class="n">dict_row</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                <span class="s1">&#39;end_time&#39;</span><span class="p">:</span> <span class="n">end_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">dict_row</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_fixed_angle"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_fixed_angle">[docs]</a><span class="k">def</span> <span class="nf">write_fixed_angle</span><span class="p">(</span><span class="n">time_data</span><span class="p">,</span> <span class="n">fixed_angle</span><span class="p">,</span> <span class="n">rad_lat</span><span class="p">,</span> <span class="n">rad_lon</span><span class="p">,</span> <span class="n">rad_alt</span><span class="p">,</span>
                      <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes an output file with the fixed angle data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    time_data : datetime object</span>
<span class="sd">        The scan time</span>
<span class="sd">    fixed_angle : float</span>
<span class="sd">        The first fixed angle in the scan</span>
<span class="sd">    rad_lat, rad_lon, rad_alt : float</span>
<span class="sd">        Latitude, longitude [deg] and altitude [m MSL] of the radar</span>
<span class="sd">    fname : str</span>
<span class="sd">        The name of the file where to write</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file containing the content</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_alt&#39;</span><span class="p">,</span> <span class="s1">&#39;fixed_angle&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;date_time&#39;</span><span class="p">:</span> <span class="n">time_data</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                <span class="s1">&#39;rad_lat&#39;</span><span class="p">:</span> <span class="n">rad_lat</span><span class="p">,</span>
                <span class="s1">&#39;rad_lon&#39;</span><span class="p">:</span> <span class="n">rad_lon</span><span class="p">,</span>
                <span class="s1">&#39;rad_alt&#39;</span><span class="p">:</span> <span class="n">rad_alt</span><span class="p">,</span>
                <span class="s1">&#39;fixed_angle&#39;</span><span class="p">:</span> <span class="n">fixed_angle</span><span class="p">})</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_alt&#39;</span><span class="p">,</span> <span class="s1">&#39;fixed_angle&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;date_time&#39;</span><span class="p">:</span> <span class="n">time_data</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                <span class="s1">&#39;rad_lat&#39;</span><span class="p">:</span> <span class="n">rad_lat</span><span class="p">,</span>
                <span class="s1">&#39;rad_lon&#39;</span><span class="p">:</span> <span class="n">rad_lon</span><span class="p">,</span>
                <span class="s1">&#39;rad_alt&#39;</span><span class="p">:</span> <span class="n">rad_alt</span><span class="p">,</span>
                <span class="s1">&#39;fixed_angle&#39;</span><span class="p">:</span> <span class="n">fixed_angle</span><span class="p">})</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="write_ts_lightning"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_ts_lightning">[docs]</a><span class="k">def</span> <span class="nf">write_ts_lightning</span><span class="p">(</span><span class="n">flashnr</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">time_in_flash</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">dBm</span><span class="p">,</span>
                       <span class="n">vals_list</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">pol_vals_labels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes the LMA sources data and the value of the colocated polarimetric</span>
<span class="sd">    variables</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flashnr : int</span>
<span class="sd">        flash number</span>
<span class="sd">    time_data : datetime object</span>
<span class="sd">        flash source time</span>
<span class="sd">    time_in_flash : float</span>
<span class="sd">        seconds since start of flash</span>
<span class="sd">    lat, lon, alt : float</span>
<span class="sd">        latitude, longitude [deg] and altitude [m MSL] of the flash source</span>
<span class="sd">    dBm : float</span>
<span class="sd">        flash power</span>
<span class="sd">    vals_list : list of arrays</span>
<span class="sd">        List containing the data for each polarimetric variable</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file containing the content</span>
<span class="sd">    pol_values_labels : list of strings</span>
<span class="sd">        List containing strings identifying each polarimetric variable</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file containing the content</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">vals_list_aux</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pol_vals_labels</span><span class="p">):</span>
            <span class="n">vals_list_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">vals_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()))</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Weather radar timeseries data file</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Project: MALSplus</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time_data</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Start : </span><span class="si">%s</span><span class="s2"> UTC</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                          <span class="n">time_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# End   : </span><span class="si">%s</span><span class="s2"> UTC</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                          <span class="n">time_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Header lines with comments are preceded by &#39;#&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;flashnr&#39;</span><span class="p">,</span> <span class="s1">&#39;time_data&#39;</span><span class="p">,</span> <span class="s1">&#39;time_in_flash&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;alt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dBm&#39;</span><span class="p">]</span>
        <span class="n">field_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pol_vals_labels</span><span class="p">)</span>

        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">field_names</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">flashnr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No data to write in file &#39;</span><span class="o">+</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">fname</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">flash</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flashnr</span><span class="p">):</span>
            <span class="n">dict_row</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;flashnr&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">flash</span><span class="p">),</span>
                <span class="s1">&#39;time_data&#39;</span><span class="p">:</span> <span class="n">time_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="s1">&#39;time_in_flash&#39;</span><span class="p">:</span> <span class="n">time_in_flash</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;alt&#39;</span><span class="p">:</span> <span class="n">alt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;dBm&#39;</span><span class="p">:</span> <span class="n">dBm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pol_vals_labels</span><span class="p">):</span>
                <span class="n">dict_row</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">vals_list_aux</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>

            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">dict_row</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="send_msg"><a class="viewcode-back" href="../../../io.html#pyrad.io.send_msg">[docs]</a><span class="k">def</span> <span class="nf">send_msg</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">receiver_list</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sends the content of a text file by email</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sender : str</span>
<span class="sd">        the email address of the sender</span>
<span class="sd">    receiver_list : list of string</span>
<span class="sd">        list with the email addresses of the receiver</span>
<span class="sd">    subject : str</span>
<span class="sd">        the subject of the email</span>
<span class="sd">    fname : str</span>
<span class="sd">        name of the file containing the content of the email message</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file containing the content</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the container email message.</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">EmailMessage</span><span class="p">()</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">receiver_list</span><span class="p">)</span>

    <span class="c1"># Open the plain text file whose name is in fname for reading.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="c1"># Create a text/plain message</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_content</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c1"># Send the message via our own SMTP server.</span>
    <span class="k">with</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_alarm_msg"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_alarm_msg">[docs]</a><span class="k">def</span> <span class="nf">write_alarm_msg</span><span class="p">(</span><span class="n">radar_name</span><span class="p">,</span> <span class="n">param_name_unit</span><span class="p">,</span> <span class="n">date_last</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">tol_abs</span><span class="p">,</span>
                    <span class="n">np_trend</span><span class="p">,</span> <span class="n">value_trend</span><span class="p">,</span> <span class="n">tol_trend</span><span class="p">,</span> <span class="n">nevents</span><span class="p">,</span> <span class="n">np_last</span><span class="p">,</span>
                    <span class="n">value_last</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes an alarm file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    radar_name : str</span>
<span class="sd">        Name of the radar being controlled</span>
<span class="sd">    param_name_unit : str</span>
<span class="sd">        Parameter and units</span>
<span class="sd">    date_last : datetime object</span>
<span class="sd">        date of the current event</span>
<span class="sd">    target, tol_abs : float</span>
<span class="sd">        Target value and tolerance</span>
<span class="sd">    np_trend : int</span>
<span class="sd">        Total number of points in trend</span>
<span class="sd">    value_trend, tol_trend : float</span>
<span class="sd">        Trend value and tolerance</span>
<span class="sd">    nevents: int</span>
<span class="sd">        Number of events in trend</span>
<span class="sd">    np_last : int</span>
<span class="sd">        Number of points in the current event</span>
<span class="sd">    value_last : float</span>
<span class="sd">        Value of the current event</span>
<span class="sd">    fname : str</span>
<span class="sd">        Name of file where to store the alarm information</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">txtfile</span><span class="p">:</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;Weather radar polarimetric parameters monitoring alarm</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">radar_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Radar name: &#39;</span><span class="o">+</span><span class="n">radar_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Parameter [Unit]: &#39;</span><span class="o">+</span><span class="n">param_name_unit</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Date : &#39;</span><span class="o">+</span><span class="n">date_last</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Target value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; +/- &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">tol_abs</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np_trend</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;Number of points in trend: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np_trend</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; in &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">nevents</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; events</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;Trend value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value_trend</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (tolerance: +/- &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">tol_trend</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of points in trend: NA</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Trend value: NA</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of points: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np_last</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value_last</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">txtfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_last_state"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_last_state">[docs]</a><span class="k">def</span> <span class="nf">write_last_state</span><span class="p">(</span><span class="n">datetime_last</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes SwissMetNet data in format datetime,avg_value, std_value</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    datetime_last : datetime object</span>
<span class="sd">        date and time of the last state</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">txtfile</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datetime_last</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">))</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">fname</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unable to write on file &#39;</span><span class="o">+</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="write_smn"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_smn">[docs]</a><span class="k">def</span> <span class="nf">write_smn</span><span class="p">(</span><span class="n">datetime_vec</span><span class="p">,</span> <span class="n">value_avg_vec</span><span class="p">,</span> <span class="n">value_std_vec</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes SwissMetNet data in format datetime,avg_value, std_value</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    datetime_vec : datetime array</span>
<span class="sd">        array containing the measurement time</span>
<span class="sd">    value_avg_vec : float array</span>
<span class="sd">        array containing the average value</span>
<span class="sd">    value_std_vec : float array</span>
<span class="sd">        array containing the standard deviation</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value_avg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value_avg_vec</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="n">datetime_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="n">value_avg</span><span class="p">,</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">value_std_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_trt_info"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_trt_info">[docs]</a><span class="k">def</span> <span class="nf">write_trt_info</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">max_rank</span><span class="p">,</span> <span class="n">nscans</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes TRT info of the thundertracking</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ids, max_rank, nscans, time_start, time_end: array</span>
<span class="sd">        the cell parameters</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;max_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;nscans_Xband&#39;</span><span class="p">,</span> <span class="s1">&#39;time_start&#39;</span><span class="p">,</span> <span class="s1">&#39;time_end&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_cell</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">id_cell</span><span class="p">,</span>
                <span class="s1">&#39;max_rank&#39;</span><span class="p">:</span> <span class="n">max_rank</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;nscans_Xband&#39;</span><span class="p">:</span> <span class="n">nscans</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;time_start&#39;</span><span class="p">:</span> <span class="n">time_start</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">),</span>
                <span class="s1">&#39;time_end&#39;</span><span class="p">:</span> <span class="n">time_end</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_trt_cell_data"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_trt_cell_data">[docs]</a><span class="k">def</span> <span class="nf">write_trt_cell_data</span><span class="p">(</span>
        <span class="n">traj_ID</span><span class="p">,</span> <span class="n">yyyymmddHHMM</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ell_L</span><span class="p">,</span> <span class="n">ell_S</span><span class="p">,</span> <span class="n">ell_or</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span>
        <span class="n">vel_x</span><span class="p">,</span> <span class="n">vel_y</span><span class="p">,</span> <span class="n">det</span><span class="p">,</span> <span class="n">RANKr</span><span class="p">,</span> <span class="n">CG_n</span><span class="p">,</span> <span class="n">CG_p</span><span class="p">,</span> <span class="n">CG</span><span class="p">,</span> <span class="n">CG_percent_p</span><span class="p">,</span> <span class="n">ET45</span><span class="p">,</span>
        <span class="n">ET45m</span><span class="p">,</span> <span class="n">ET15</span><span class="p">,</span> <span class="n">ET15m</span><span class="p">,</span> <span class="n">VIL</span><span class="p">,</span> <span class="n">maxH</span><span class="p">,</span> <span class="n">maxHm</span><span class="p">,</span> <span class="n">POH</span><span class="p">,</span> <span class="n">RANK</span><span class="p">,</span> <span class="n">Dvel_x</span><span class="p">,</span>
        <span class="n">Dvel_y</span><span class="p">,</span> <span class="n">cell_contour</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes TRT cell data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    traj_ID, yyyymmddHHMM, lon, lat, ell_L, ell_S, ell_or, area,</span>
<span class="sd">    vel_x, vel_y, det, RANKr, CG_n, CG_p, CG, CG_percent_p, ET45,</span>
<span class="sd">    ET45m, ET15, ET15m, VIL, maxH, maxHm, POH, RANK, Dvel_x,</span>
<span class="sd">    Dvel_y, cell_contour:</span>
<span class="sd">        the cell parameters</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;traj_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyymmddHHMM&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_L&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_S&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ell_or&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;vel_x&#39;</span><span class="p">,</span> <span class="s1">&#39;vel_y&#39;</span><span class="p">,</span> <span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;RANKr&#39;</span><span class="p">,</span> <span class="s1">&#39;CG-&#39;</span><span class="p">,</span>
                <span class="s1">&#39;CG+&#39;</span><span class="p">,</span> <span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="s1">&#39;%CG+&#39;</span><span class="p">,</span> <span class="s1">&#39;ET45&#39;</span><span class="p">,</span> <span class="s1">&#39;ET45m&#39;</span><span class="p">,</span> <span class="s1">&#39;ET15&#39;</span><span class="p">,</span> <span class="s1">&#39;ET15m&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VIL&#39;</span><span class="p">,</span> <span class="s1">&#39;maxH&#39;</span><span class="p">,</span> <span class="s1">&#39;maxHm&#39;</span><span class="p">,</span> <span class="s1">&#39;POH&#39;</span><span class="p">,</span> <span class="s1">&#39;RANK&#39;</span><span class="p">,</span> <span class="s1">&#39;Dvel_x&#39;</span><span class="p">,</span> <span class="s1">&#39;Dvel_y&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cell_contour_lon-lat&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">traj_ID_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traj_ID</span><span class="p">):</span>
                <span class="n">cell_contour_aux</span> <span class="o">=</span> <span class="n">cell_contour</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">npoints_contour</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_contour_aux</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="n">cell_contour_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">npoints_contour</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">cell_contour_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_contour_aux</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
                <span class="n">cell_contour_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_contour_aux</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
                <span class="n">cell_contour_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell_contour_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">npoints_contour</span><span class="p">):</span>
                    <span class="n">cell_contour_str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_contour_arr</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;traj_ID&#39;</span><span class="p">:</span> <span class="n">traj_ID_el</span><span class="p">,</span>
                    <span class="s1">&#39;yyyymmddHHMM&#39;</span><span class="p">:</span> <span class="n">yyyymmddHHMM</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ell_L&#39;</span><span class="p">:</span> <span class="n">ell_L</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ell_S&#39;</span><span class="p">:</span> <span class="n">ell_S</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ell_or&#39;</span><span class="p">:</span> <span class="n">ell_or</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="n">area</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;vel_x&#39;</span><span class="p">:</span> <span class="n">vel_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;vel_y&#39;</span><span class="p">:</span> <span class="n">vel_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;det&#39;</span><span class="p">:</span> <span class="n">det</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;RANKr&#39;</span><span class="p">:</span> <span class="n">RANKr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;CG-&#39;</span><span class="p">:</span> <span class="n">CG_n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;CG+&#39;</span><span class="p">:</span> <span class="n">CG_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;CG&#39;</span><span class="p">:</span> <span class="n">CG</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;%CG+&#39;</span><span class="p">:</span> <span class="n">CG_percent_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET45&#39;</span><span class="p">:</span> <span class="n">ET45</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET45m&#39;</span><span class="p">:</span> <span class="n">ET45m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET15&#39;</span><span class="p">:</span> <span class="n">ET15</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET15m&#39;</span><span class="p">:</span> <span class="n">ET15m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;VIL&#39;</span><span class="p">:</span> <span class="n">VIL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;maxH&#39;</span><span class="p">:</span> <span class="n">maxH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;maxHm&#39;</span><span class="p">:</span> <span class="n">maxHm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;POH&#39;</span><span class="p">:</span> <span class="n">POH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;RANK&#39;</span><span class="p">:</span> <span class="n">RANK</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;Dvel_x&#39;</span><span class="p">:</span> <span class="n">Dvel_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;Dvel_y&#39;</span><span class="p">:</span> <span class="n">Dvel_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;cell_contour_lon-lat&#39;</span><span class="p">:</span> <span class="n">cell_contour_str</span>
                <span class="p">})</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">fname</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unable to write on file &#39;</span><span class="o">+</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="write_trt_thundertracking_data"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_trt_thundertracking_data">[docs]</a><span class="k">def</span> <span class="nf">write_trt_thundertracking_data</span><span class="p">(</span>
        <span class="n">traj_ID</span><span class="p">,</span> <span class="n">scan_ordered_time</span><span class="p">,</span> <span class="n">scan_time</span><span class="p">,</span> <span class="n">azi</span><span class="p">,</span> <span class="n">rng</span><span class="p">,</span> <span class="n">yyyymmddHHMM</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span>
        <span class="n">lat</span><span class="p">,</span> <span class="n">ell_L</span><span class="p">,</span> <span class="n">ell_S</span><span class="p">,</span> <span class="n">ell_or</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">vel_x</span><span class="p">,</span> <span class="n">vel_y</span><span class="p">,</span> <span class="n">det</span><span class="p">,</span> <span class="n">RANKr</span><span class="p">,</span> <span class="n">CG_n</span><span class="p">,</span> <span class="n">CG_p</span><span class="p">,</span>
        <span class="n">CG</span><span class="p">,</span> <span class="n">CG_percent_p</span><span class="p">,</span> <span class="n">ET45</span><span class="p">,</span> <span class="n">ET45m</span><span class="p">,</span> <span class="n">ET15</span><span class="p">,</span> <span class="n">ET15m</span><span class="p">,</span> <span class="n">VIL</span><span class="p">,</span> <span class="n">maxH</span><span class="p">,</span> <span class="n">maxHm</span><span class="p">,</span> <span class="n">POH</span><span class="p">,</span>
        <span class="n">RANK</span><span class="p">,</span> <span class="n">Dvel_x</span><span class="p">,</span> <span class="n">Dvel_y</span><span class="p">,</span> <span class="n">cell_contour</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes TRT cell data of the thundertracking scan</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    traj_ID, scan_ordered_time, scan_time, azi, rng, yyyymmddHHMM, lon, lat,</span>
<span class="sd">    ell_L, ell_S, ell_or, area, vel_x, vel_y, det, RANKr, CG_n, CG_p, CG,</span>
<span class="sd">    CG_percent_p, ET45, ET45m, ET15, ET15m, VIL, maxH, maxHm, POH, RANK,</span>
<span class="sd">    Dvel_x, Dvel_y, cell_contour:</span>
<span class="sd">        the cell parameters</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;traj_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_ordered_time&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_time&#39;</span><span class="p">,</span> <span class="s1">&#39;azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rng&#39;</span><span class="p">,</span>
                <span class="s1">&#39;yyyymmddHHMM&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_L&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_S&#39;</span><span class="p">,</span> <span class="s1">&#39;ell_or&#39;</span><span class="p">,</span>
                <span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;vel_x&#39;</span><span class="p">,</span> <span class="s1">&#39;vel_y&#39;</span><span class="p">,</span> <span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;RANKr&#39;</span><span class="p">,</span> <span class="s1">&#39;CG-&#39;</span><span class="p">,</span> <span class="s1">&#39;CG+&#39;</span><span class="p">,</span> <span class="s1">&#39;CG&#39;</span><span class="p">,</span>
                <span class="s1">&#39;%CG+&#39;</span><span class="p">,</span> <span class="s1">&#39;ET45&#39;</span><span class="p">,</span> <span class="s1">&#39;ET45m&#39;</span><span class="p">,</span> <span class="s1">&#39;ET15&#39;</span><span class="p">,</span> <span class="s1">&#39;ET15m&#39;</span><span class="p">,</span> <span class="s1">&#39;VIL&#39;</span><span class="p">,</span> <span class="s1">&#39;maxH&#39;</span><span class="p">,</span>
                <span class="s1">&#39;maxHm&#39;</span><span class="p">,</span> <span class="s1">&#39;POH&#39;</span><span class="p">,</span> <span class="s1">&#39;RANK&#39;</span><span class="p">,</span> <span class="s1">&#39;Dvel_x&#39;</span><span class="p">,</span> <span class="s1">&#39;Dvel_y&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cell_contour_lon-lat&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">traj_ID_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traj_ID</span><span class="p">):</span>
                <span class="n">cell_contour_aux</span> <span class="o">=</span> <span class="n">cell_contour</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">npoints_contour</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_contour_aux</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="n">cell_contour_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">npoints_contour</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">cell_contour_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_contour_aux</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
                <span class="n">cell_contour_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_contour_aux</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
                <span class="n">cell_contour_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell_contour_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">npoints_contour</span><span class="p">):</span>
                    <span class="n">cell_contour_str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_contour_arr</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">scan_time</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">scan_time_str</span> <span class="o">=</span> <span class="n">get_fillvalue</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scan_time_str</span> <span class="o">=</span> <span class="n">scan_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;traj_ID&#39;</span><span class="p">:</span> <span class="n">traj_ID_el</span><span class="p">,</span>
                    <span class="s1">&#39;scan_ordered_time&#39;</span><span class="p">:</span> <span class="n">scan_ordered_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                        <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;scan_time&#39;</span><span class="p">:</span> <span class="n">scan_time_str</span><span class="p">,</span>
                    <span class="s1">&#39;azi&#39;</span><span class="p">:</span> <span class="n">azi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rng&#39;</span><span class="p">:</span> <span class="n">rng</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;yyyymmddHHMM&#39;</span><span class="p">:</span> <span class="n">yyyymmddHHMM</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ell_L&#39;</span><span class="p">:</span> <span class="n">ell_L</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ell_S&#39;</span><span class="p">:</span> <span class="n">ell_S</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ell_or&#39;</span><span class="p">:</span> <span class="n">ell_or</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="n">area</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;vel_x&#39;</span><span class="p">:</span> <span class="n">vel_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;vel_y&#39;</span><span class="p">:</span> <span class="n">vel_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;det&#39;</span><span class="p">:</span> <span class="n">det</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;RANKr&#39;</span><span class="p">:</span> <span class="n">RANKr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;CG-&#39;</span><span class="p">:</span> <span class="n">CG_n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;CG+&#39;</span><span class="p">:</span> <span class="n">CG_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;CG&#39;</span><span class="p">:</span> <span class="n">CG</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;%CG+&#39;</span><span class="p">:</span> <span class="n">CG_percent_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET45&#39;</span><span class="p">:</span> <span class="n">ET45</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET45m&#39;</span><span class="p">:</span> <span class="n">ET45m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET15&#39;</span><span class="p">:</span> <span class="n">ET15</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ET15m&#39;</span><span class="p">:</span> <span class="n">ET15m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;VIL&#39;</span><span class="p">:</span> <span class="n">VIL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;maxH&#39;</span><span class="p">:</span> <span class="n">maxH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;maxHm&#39;</span><span class="p">:</span> <span class="n">maxHm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;POH&#39;</span><span class="p">:</span> <span class="n">POH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;RANK&#39;</span><span class="p">:</span> <span class="n">RANK</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;Dvel_x&#39;</span><span class="p">:</span> <span class="n">Dvel_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;Dvel_y&#39;</span><span class="p">:</span> <span class="n">Dvel_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;cell_contour_lon-lat&#39;</span><span class="p">:</span> <span class="n">cell_contour_str</span>
                <span class="p">})</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">fname</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unable to write on file &#39;</span><span class="o">+</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="write_trt_cell_scores"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_trt_cell_scores">[docs]</a><span class="k">def</span> <span class="nf">write_trt_cell_scores</span><span class="p">(</span>
        <span class="n">traj_ID</span><span class="p">,</span> <span class="n">flash_density_max_time</span><span class="p">,</span> <span class="n">flash_density_max_rank</span><span class="p">,</span>
        <span class="n">nflashes_max_list</span><span class="p">,</span> <span class="n">area_flash_max_list</span><span class="p">,</span> <span class="n">flash_density_max</span><span class="p">,</span>
        <span class="n">rank_max_time</span><span class="p">,</span> <span class="n">rank_max</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes TRT cells scores</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    traj_ID : array of ints</span>
<span class="sd">        The ID of the cells</span>
<span class="sd">    flash_density_max_time : array of date times</span>
<span class="sd">        The time at which the maximum flash density was reached for each cell</span>
<span class="sd">    flash_density_max_rank : array of floats</span>
<span class="sd">        The rank when the maximum flash density was reached for each cell</span>
<span class="sd">    nflashes_max_list : array of ints</span>
<span class="sd">        the number of flashes when the max flash density was reached</span>
<span class="sd">    area_flash_max_list : array of floats</span>
<span class="sd">        The area when the max flash density was reached</span>
<span class="sd">    flash_density_max : array of floats</span>
<span class="sd">        The maximum flash density for each cell</span>
<span class="sd">    rank_max_time : array of datetime</span>
<span class="sd">        the time at wich the maximum rank of each cell was reached</span>
<span class="sd">    rank_max : array of float</span>
<span class="sd">        the rank when the maximum rank of each cell was reached</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;traj ID&#39;</span><span class="p">,</span> <span class="s1">&#39;max flash density time&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max flash density rank&#39;</span><span class="p">,</span> <span class="s1">&#39;max flash density flashes&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max flash density area&#39;</span><span class="p">,</span> <span class="s1">&#39;max flash density&#39;</span><span class="p">,</span> <span class="s1">&#39;max rank time&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max rank&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">traj_ID_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traj_ID</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;traj ID&#39;</span><span class="p">:</span> <span class="n">traj_ID_el</span><span class="p">,</span>
                <span class="s1">&#39;max flash density time&#39;</span><span class="p">:</span> <span class="n">flash_density_max_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                    <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
                <span class="s1">&#39;max flash density rank&#39;</span><span class="p">:</span> <span class="n">flash_density_max_rank</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;max flash density flashes&#39;</span><span class="p">:</span> <span class="n">nflashes_max_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;max flash density area&#39;</span><span class="p">:</span> <span class="n">area_flash_max_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;max flash density&#39;</span><span class="p">:</span> <span class="n">flash_density_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;max rank time&#39;</span><span class="p">:</span> <span class="n">rank_max_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                    <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
                <span class="s1">&#39;max rank&#39;</span><span class="p">:</span> <span class="n">rank_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_trt_cell_lightning"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_trt_cell_lightning">[docs]</a><span class="k">def</span> <span class="nf">write_trt_cell_lightning</span><span class="p">(</span>
        <span class="n">cell_ID</span><span class="p">,</span> <span class="n">cell_time</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">nflash</span><span class="p">,</span> <span class="n">flash_density</span><span class="p">,</span>
        <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes the lightning data for each TRT cell</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cell_ID : array of ints</span>
<span class="sd">        the cell ID</span>
<span class="sd">    cell_time : array of datetime</span>
<span class="sd">        the time step</span>
<span class="sd">    lon, lat : array of floats</span>
<span class="sd">        the latitude and longitude of the center of the cell</span>
<span class="sd">    area : array of floats</span>
<span class="sd">        the area of the cell</span>
<span class="sd">    rank : array of floats</span>
<span class="sd">        the rank of the cell</span>
<span class="sd">    nflash : array of ints</span>
<span class="sd">        the number of flashes/sources within the cell</span>
<span class="sd">    flash_density : array of floats</span>
<span class="sd">        the flash/source density</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nflash</span> <span class="o">=</span> <span class="n">nflash</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">flash_density</span> <span class="o">=</span> <span class="n">flash_density</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;traj_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyymmddHHMM&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;RANKr&#39;</span><span class="p">,</span>
            <span class="s1">&#39;nflashes&#39;</span><span class="p">,</span> <span class="s1">&#39;flash_dens&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">traj_ID_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cell_ID</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;traj_ID&#39;</span><span class="p">:</span> <span class="n">traj_ID_el</span><span class="p">,</span>
                <span class="s1">&#39;yyyymmddHHMM&#39;</span><span class="p">:</span> <span class="n">cell_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">),</span>
                <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="n">area</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;RANKr&#39;</span><span class="p">:</span> <span class="n">rank</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;nflashes&#39;</span><span class="p">:</span> <span class="n">nflash</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;flash_dens&#39;</span><span class="p">:</span> <span class="n">flash_density</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_rhi_profile"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_rhi_profile">[docs]</a><span class="k">def</span> <span class="nf">write_rhi_profile</span><span class="p">(</span><span class="n">hvec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">nvalid_vec</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">timeinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes the values of an RHI profile in a text file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hvec : float array</span>
<span class="sd">        array containing the alitude in m MSL</span>
<span class="sd">    data : list of float array</span>
<span class="sd">        the quantities at each altitude</span>
<span class="sd">    nvalid_vec : int array</span>
<span class="sd">        number of valid data points used to compute the quantiles</span>
<span class="sd">    labels : list of strings</span>
<span class="sd">        label specifying the quantitites in data</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>
<span class="sd">    datatype : str</span>
<span class="sd">        the data type</span>
<span class="sd">    timeinfo : datetime object</span>
<span class="sd">        time of the rhi profile</span>
<span class="sd">    sector : dict</span>
<span class="sd">        dictionary specying the sector limits</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has been written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_aux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">data_points</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_points</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Height Profile</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# ==============</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Datatype (Unit) : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Datatype (Unit) : &#39;</span><span class="o">+</span><span class="n">datatype</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Fill value : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Time     : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Time     : &#39;</span> <span class="o">+</span>
                          <span class="n">timeinfo</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Sector specification: None</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Sector specification:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#   Azimuth         : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;az&#39;</span><span class="p">])</span> <span class="o">+</span>
                          <span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#   Range start     : &#39;</span> <span class="o">+</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;rmin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#   Range stop      : &#39;</span> <span class="o">+</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Altitude [m MSL]&#39;</span><span class="p">]</span>
        <span class="n">fieldnames</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;N valid&#39;</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">height</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hvec</span><span class="p">):</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">fieldnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">height</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
                <span class="n">data_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">fieldnames</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span> <span class="n">data_aux</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]})</span>
            <span class="n">data_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">fieldnames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="n">nvalid_vec</span><span class="p">[</span><span class="n">j</span><span class="p">]})</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_field_coverage"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_field_coverage">[docs]</a><span class="k">def</span> <span class="nf">write_field_coverage</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">ele_start</span><span class="p">,</span> <span class="n">ele_stop</span><span class="p">,</span> <span class="n">azi_start</span><span class="p">,</span>
                         <span class="n">azi_stop</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">nvalid_min</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">timeinfo</span><span class="p">,</span>
                         <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes the quantiles of the coverage on a particular sector</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    quantiles : datetime array</span>
<span class="sd">        array containing the quantiles computed</span>
<span class="sd">    values : float array</span>
<span class="sd">        quantile value</span>
<span class="sd">    ele_start, ele_stop, azi_start, azi_stop : float</span>
<span class="sd">        The limits of the sector</span>
<span class="sd">    threshold : float</span>
<span class="sd">        The minimum value to consider the data valid</span>
<span class="sd">    nvalid_min : int</span>
<span class="sd">        the minimum number of points to consider that there are values in a</span>
<span class="sd">        ray</span>
<span class="sd">    datatype : str</span>
<span class="sd">        data type and units</span>
<span class="sd">    timeinfo : datetime object</span>
<span class="sd">        the time stamp of the data</span>
<span class="sd">    fname : str</span>
<span class="sd">        name of the file where to write the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Quantiles of the field coverage</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Datatype (Unit) : &#39;</span><span class="o">+</span><span class="n">datatype</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Time : &#39;</span><span class="o">+</span><span class="n">timeinfo</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Sector specification:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#   Azimuth start   : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">azi_start</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#   Azimuth stop    : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">azi_stop</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#   Elevation start : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ele_start</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#   Elevation stop  : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ele_stop</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Threshold : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Minimum number of valid gates per ray : &#39;</span> <span class="o">+</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">nvalid_min</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Quantile [%]&#39;</span><span class="p">,</span> <span class="s1">&#39;Rain extension [m]&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">quantiles</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;Quantile [%]&#39;</span><span class="p">:</span> <span class="n">quant</span><span class="p">,</span>
                <span class="s1">&#39;Rain extension [m]&#39;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_cdf"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_cdf">[docs]</a><span class="k">def</span> <span class="nf">write_cdf</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">ntot</span><span class="p">,</span> <span class="n">nnan</span><span class="p">,</span> <span class="n">nclut</span><span class="p">,</span> <span class="n">nblocked</span><span class="p">,</span> <span class="n">nprec_filter</span><span class="p">,</span>
              <span class="n">noutliers</span><span class="p">,</span> <span class="n">ncdf</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">use_nans</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nan_value</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
              <span class="n">filterprec</span><span class="o">=</span><span class="p">[],</span> <span class="n">vismin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">timeinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes a cumulative distribution function</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    quantiles : datetime array</span>
<span class="sd">        array containing the measurement time</span>
<span class="sd">    values : float array</span>
<span class="sd">        array containing the average value</span>
<span class="sd">    fname : float array</span>
<span class="sd">        array containing the standard deviation</span>
<span class="sd">    sector : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hydrotype_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NC&#39;</span><span class="p">,</span> <span class="s1">&#39;DS&#39;</span><span class="p">,</span> <span class="s1">&#39;CR&#39;</span><span class="p">,</span> <span class="s1">&#39;LR&#39;</span><span class="p">,</span> <span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="s1">&#39;RN&#39;</span><span class="p">,</span> <span class="s1">&#39;VI&#39;</span><span class="p">,</span> <span class="s1">&#39;WS&#39;</span><span class="p">,</span> <span class="s1">&#39;MH&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;IH/HDG&#39;</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">txtfile</span><span class="p">:</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Statistical analysis</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;====================</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Datatype (Unit) : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Datatype (Unit) : &#39;</span><span class="o">+</span><span class="n">datatype</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Time     : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Time     : &#39;</span> <span class="o">+</span>
                          <span class="n">timeinfo</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Sector specification: None</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Sector specification:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;rmin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Range start     : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Range start     : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;rmin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Range stop      : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Range stop      : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;azmin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Azimuth start   : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Azimuth start   : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;azmin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;azmax&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Azimuth stop    : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Azimuth stop    : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;azmax&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;elmin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Elevation start : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Elevation start : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;elmin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;elmax&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Elevation stop  : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Elevation stop  : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;elmax&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;hmin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Height start    : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Height start    : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;hmin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sector</span><span class="p">[</span><span class="s1">&#39;hmax&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Height stop     : Not specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Height stop     : &#39;</span> <span class="o">+</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">[</span><span class="s1">&#39;hmax&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Total number of gates in sector      : &#39;</span> <span class="o">+</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">ntot</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of gates with no value (NaNs) : &#39;</span> <span class="o">+</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">nnan</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nans</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  NaNs are set to          : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nan_value</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  NaNs are ignored!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nclut</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Clutter contaminated gates           : &#39;</span> <span class="o">+</span>
                          <span class="s1">&#39;Not checked</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Clutter contaminated gates           : &#39;</span> <span class="o">+</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">nclut</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nblocked</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Blocked gates                        : &#39;</span> <span class="o">+</span>
                          <span class="s1">&#39;Not checked</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Blocked gates (vismin = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vismin</span><span class="p">))</span> <span class="o">+</span>
                          <span class="s1">&#39;) : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nblocked</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nprec_filter</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Filtered precipitation gates         : None</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Filtered precipitation gates         : &#39;</span> <span class="o">+</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">nprec_filter</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  precipitation types filtered: &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind_hydro</span> <span class="ow">in</span> <span class="n">filterprec</span><span class="p">:</span>
                <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">hydrotype_list</span><span class="p">[</span><span class="n">ind_hydro</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of outliers                   : &#39;</span> <span class="o">+</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">noutliers</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of gates used for histogram   : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ncdf</span><span class="p">)</span> <span class="o">+</span>
                      <span class="s1">&#39; (&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ncdf</span><span class="o">*</span><span class="mf">100.</span><span class="o">/</span><span class="n">ntot</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;%)</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Quantiles</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;=========</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">txtfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  Quantile_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">quantiles</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">+</span><span class="s1">&#39; = &#39;</span> <span class="o">+</span>
                          <span class="s1">&#39;</span><span class="si">{:5.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">txtfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_histogram"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_histogram">[docs]</a><span class="k">def</span> <span class="nf">write_histogram</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;undefined&#39;</span><span class="p">,</span>
                    <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes a histogram</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bin_edges : float array</span>
<span class="sd">        array containing the histogram bin edges</span>
<span class="sd">    values : int array</span>
<span class="sd">        array containing the number of points in each bin</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name</span>
<span class="sd">    datatype :str</span>
<span class="sd">        The data type</span>
<span class="sd">    step : str</span>
<span class="sd">        The bin step</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">datatype_str</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
        <span class="k">if</span> <span class="n">datatype</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">:</span>
            <span class="n">datatype_str</span> <span class="o">=</span> <span class="n">generate_field_name_str</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;# Weather radar data histogram file</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Description:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Histogram of weather radar data.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Data: &#39;</span><span class="o">+</span><span class="n">datatype_str</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Step: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bin_edge_left&#39;</span><span class="p">,</span> <span class="s1">&#39;bin_edge_right&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;bin_edge_left&#39;</span><span class="p">:</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;bin_edge_right&#39;</span><span class="p">:</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_quantiles"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_quantiles">[docs]</a><span class="k">def</span> <span class="nf">write_quantiles</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;undefined&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes quantiles</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    quantiles : float array</span>
<span class="sd">        array containing the quantiles to write</span>
<span class="sd">    values : float array</span>
<span class="sd">        array containing the value of each quantile</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name</span>
<span class="sd">    datatype :str</span>
<span class="sd">        The data type</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values_aux</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;# Weather radar data histogram file</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Description:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Histogram of weather radar data.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;# Data: &#39;</span><span class="o">+</span><span class="n">generate_field_name_str</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;quantile&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">quantiles</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;quantile&#39;</span><span class="p">:</span> <span class="n">quant</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">values_aux</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_ts_polar_data"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_ts_polar_data">[docs]</a><span class="k">def</span> <span class="nf">write_ts_polar_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes time series of data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset : dict</span>
<span class="sd">        dictionary containing the time series parameters</span>

<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Weather radar timeseries data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Description: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Time series of a weather radar data over a &#39;</span> <span class="o">+</span>
                          <span class="s1">&#39;fixed location.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;# Location [lon, lat, alt]: &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;point_coordinates_WGS84_lon_lat_alt&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;# Nominal antenna coordinates used [az, el, r]: &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;antenna_coordinates_az_el_r&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;# Data: &#39;</span><span class="o">+</span><span class="n">generate_field_name_str</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;datatype&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Fill Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;# Start: &#39;</span> <span class="o">+</span>
                <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;az&#39;</span><span class="p">,</span> <span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;az&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;used_antenna_coordinates_az_el_r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s1">&#39;el&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;used_antenna_coordinates_az_el_r&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;used_antenna_coordinates_az_el_r&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;az&#39;</span><span class="p">,</span> <span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;az&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;used_antenna_coordinates_az_el_r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s1">&#39;el&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;used_antenna_coordinates_az_el_r&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;used_antenna_coordinates_az_el_r&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<span class="k">def</span> <span class="nf">write_ts_ml</span><span class="p">(</span><span class="n">dt_ml</span><span class="p">,</span> <span class="n">ml_top_avg</span><span class="p">,</span> <span class="n">ml_top_std</span><span class="p">,</span> <span class="n">thick_avg</span><span class="p">,</span> <span class="n">thick_std</span><span class="p">,</span>
                <span class="n">nrays_valid</span><span class="p">,</span> <span class="n">nrays_total</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes time series of melting layer data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dt_ml : date time array</span>
<span class="sd">        array of time steps</span>
<span class="sd">    ml_top_avg, ml_top_std: float arrays</span>
<span class="sd">        the average and the standard deviation of the melting layer top height</span>
<span class="sd">    thick_avg, thick_std: float arrays</span>
<span class="sd">        the average and the standard deviation of the metling layer thickness</span>
<span class="sd">    nrays_valid, nrays_total: int arrays</span>
<span class="sd">        the number of rays where melting layer has been identified and the</span>
<span class="sd">        total number of arrays in the scan</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;# Weather radar detected melting layer data file</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Description: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Time series of melting layer data detected by weather radar.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Fill Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Start: &#39;</span><span class="o">+</span><span class="n">dt_ml</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;date-time [UTC]&#39;</span><span class="p">,</span> <span class="s1">&#39;mean ml top height [m MSL]&#39;</span><span class="p">,</span>
                <span class="s1">&#39;std ml top height [m MSL]&#39;</span><span class="p">,</span> <span class="s1">&#39;mean ml thickness [m]&#39;</span><span class="p">,</span>
                <span class="s1">&#39;std ml thickness [m]&#39;</span><span class="p">,</span> <span class="s1">&#39;N valid rays&#39;</span><span class="p">,</span> <span class="s1">&#39;rays total&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;date-time [UTC]&#39;</span><span class="p">:</span> <span class="n">dt_ml</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;mean ml top height [m MSL]&#39;</span><span class="p">:</span> <span class="n">ml_top_avg</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;std ml top height [m MSL]&#39;</span><span class="p">:</span> <span class="n">ml_top_std</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;mean ml thickness [m]&#39;</span><span class="p">:</span> <span class="n">thick_avg</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;std ml thickness [m]&#39;</span><span class="p">:</span> <span class="n">thick_std</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;N valid rays&#39;</span><span class="p">:</span> <span class="n">nrays_valid</span><span class="p">,</span>
                 <span class="s1">&#39;rays total&#39;</span><span class="p">:</span> <span class="n">nrays_total</span><span class="p">})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;date-time [UTC]&#39;</span><span class="p">,</span> <span class="s1">&#39;mean ml top height [m MSL]&#39;</span><span class="p">,</span>
                <span class="s1">&#39;std ml top height [m MSL]&#39;</span><span class="p">,</span> <span class="s1">&#39;mean ml thickness [m]&#39;</span><span class="p">,</span>
                <span class="s1">&#39;std ml thickness [m]&#39;</span><span class="p">,</span> <span class="s1">&#39;N valid rays&#39;</span><span class="p">,</span> <span class="s1">&#39;rays total&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;date-time [UTC]&#39;</span><span class="p">:</span> <span class="n">dt_ml</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;mean ml top height [m MSL]&#39;</span><span class="p">:</span> <span class="n">ml_top_avg</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;std ml top height [m MSL]&#39;</span><span class="p">:</span> <span class="n">ml_top_std</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;mean ml thickness [m]&#39;</span><span class="p">:</span> <span class="n">thick_avg</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;std ml thickness [m]&#39;</span><span class="p">:</span> <span class="n">thick_std</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">()),</span>
                 <span class="s1">&#39;N valid rays&#39;</span><span class="p">:</span> <span class="n">nrays_valid</span><span class="p">,</span>
                 <span class="s1">&#39;rays total&#39;</span><span class="p">:</span> <span class="n">nrays_total</span><span class="p">})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span>


<div class="viewcode-block" id="write_ts_cum"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_ts_cum">[docs]</a><span class="k">def</span> <span class="nf">write_ts_cum</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes time series accumulation of data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset : dict</span>
<span class="sd">        dictionary containing the time series parameters</span>

<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radar_value</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;radar_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;sensor_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">np_radar</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;np_radar&#39;</span><span class="p">]</span>
    <span class="n">np_sensor</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;np_sensor&#39;</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Precipitation accumulation data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Description: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Time series of a precipitation accumulation of &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;weather radar data and another sensor over a &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;fixed location.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;# Location [lon, lat, alt]: &#39;</span> <span class="o">+</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;point_coordinates_WGS84_lon_lat_alt&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;# Nominal antenna coordinates used [az, el, r]: &#39;</span> <span class="o">+</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;antenna_coordinates_az_el_r&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# sensor type: &#39;</span> <span class="o">+</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;sensor&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# sensor ID: &#39;</span> <span class="o">+</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;sensorid&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Data: Precipitation accumulation over &#39;</span> <span class="o">+</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;cum_time&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Fill Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;# Start: &#39;</span> <span class="o">+</span>
            <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;np_radar&#39;</span><span class="p">,</span> <span class="s1">&#39;radar_value&#39;</span><span class="p">,</span> <span class="s1">&#39;np_sensor&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sensor_value&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rad_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">radar_value</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;np_radar&#39;</span><span class="p">:</span> <span class="n">np_radar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;radar_value&#39;</span><span class="p">:</span> <span class="n">rad_val</span><span class="p">,</span>
                <span class="s1">&#39;np_sensor&#39;</span><span class="p">:</span> <span class="n">np_sensor</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;sensor_value&#39;</span><span class="p">:</span> <span class="n">sensor_value</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_monitoring_ts"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_monitoring_ts">[docs]</a><span class="k">def</span> <span class="nf">write_monitoring_ts</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">np_t</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span>
                        <span class="n">rewrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes time series of data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start_time : datetime object or array of date time objects</span>
<span class="sd">        the time of the monitoring</span>
<span class="sd">    np_t : int or array of ints</span>
<span class="sd">        the total number of points</span>
<span class="sd">    values: float array with 3 elements of array of arrays</span>
<span class="sd">        the values at certain quantiles</span>
<span class="sd">    quantiles: float array with 3 elements</span>
<span class="sd">        the quantiles computed</span>
<span class="sd">    datatype : str</span>
<span class="sd">        The data type</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>
<span class="sd">    rewrite : bool</span>
<span class="sd">        if True a new file is created</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nvalues</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start_time_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">start_time</span><span class="p">])</span>
        <span class="n">np_t_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">np_t</span><span class="p">])</span>
        <span class="n">values_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">values</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_time_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
        <span class="n">values_aux</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
        <span class="n">np_t_aux</span> <span class="o">=</span> <span class="n">np_t</span>

    <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span>
        <span class="n">file_exists</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="n">file_exists</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_exists</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_exists</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EAGAIN</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;# Weather radar monitoring timeseries data file</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Description: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Time series of a monitoring of weather radar data.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Quantiles: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;, &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; percent.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Data: &#39;</span><span class="o">+</span><span class="n">generate_field_name_str</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Fill Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Start: &#39;</span><span class="o">+</span><span class="n">start_time_aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                    <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="s1">&#39;central_quantile&#39;</span><span class="p">,</span> <span class="s1">&#39;low_quantile&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;high_quantile&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">np_t_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np_t_aux</span><span class="p">):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">start_time_aux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;NP&#39;</span><span class="p">:</span> <span class="n">np_t_el</span><span class="p">,</span>
                    <span class="s1">&#39;central_quantile&#39;</span><span class="p">:</span> <span class="n">values_aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;low_quantile&#39;</span><span class="p">:</span> <span class="n">values_aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;high_quantile&#39;</span><span class="p">:</span> <span class="n">values_aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>

            <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EAGAIN</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="s1">&#39;central_quantile&#39;</span><span class="p">,</span> <span class="s1">&#39;low_quantile&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;high_quantile&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">np_t_el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np_t_aux</span><span class="p">):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">start_time_aux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;NP&#39;</span><span class="p">:</span> <span class="n">np_t_el</span><span class="p">,</span>
                    <span class="s1">&#39;central_quantile&#39;</span><span class="p">:</span> <span class="n">values_aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;low_quantile&#39;</span><span class="p">:</span> <span class="n">values_aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;high_quantile&#39;</span><span class="p">:</span> <span class="n">values_aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
            <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_excess_gates"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_excess_gates">[docs]</a><span class="k">def</span> <span class="nf">write_excess_gates</span><span class="p">(</span><span class="n">excess_dict</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the position and values of gates that have a frequency of</span>
<span class="sd">    occurrence higher than a particular threshold</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    excess_dict : dict</span>
<span class="sd">        dictionary containing the gates parameters</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ngates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;ray_ind&#39;</span><span class="p">])</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Gates exceeding &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;quant_min&#39;</span><span class="p">])</span> <span class="o">+</span>
                      <span class="s1">&#39; percentile data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;# Data collection start time: &#39;</span> <span class="o">+</span>
            <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;# Data collection end time: &#39;</span> <span class="o">+</span>
            <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Number of gates in file: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ngates</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;ele&#39;</span><span class="p">,</span> <span class="s1">&#39;azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rng&#39;</span><span class="p">,</span> <span class="s1">&#39;nsamples&#39;</span><span class="p">,</span>
            <span class="s1">&#39;occurrence&#39;</span><span class="p">,</span> <span class="s1">&#39;freq_occu&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ray_ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;ray_ind&#39;</span><span class="p">]):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;ray_ind&#39;</span><span class="p">:</span> <span class="n">ray_ind</span><span class="p">,</span>
                <span class="s1">&#39;rng_ind&#39;</span><span class="p">:</span> <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;ele&#39;</span><span class="p">:</span> <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;azi&#39;</span><span class="p">:</span> <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rng&#39;</span><span class="p">:</span> <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;nsamples&#39;</span><span class="p">:</span> <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;nsamples&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;occurrence&#39;</span><span class="p">:</span> <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;occurrence&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;freq_occu&#39;</span><span class="p">:</span> <span class="n">excess_dict</span><span class="p">[</span><span class="s1">&#39;freq_occu&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_intercomp_scores_ts"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_intercomp_scores_ts">[docs]</a><span class="k">def</span> <span class="nf">write_intercomp_scores_ts</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span>
                              <span class="n">rad1_name</span><span class="o">=</span><span class="s1">&#39;RADAR001&#39;</span><span class="p">,</span> <span class="n">rad2_name</span><span class="o">=</span><span class="s1">&#39;RADAR002&#39;</span><span class="p">,</span>
                              <span class="n">rewrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes time series of radar intercomparison scores</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start_time : datetime object or array of date time objects</span>
<span class="sd">        the time of the intercomparison</span>
<span class="sd">    stats : dict</span>
<span class="sd">        dictionary containing the statistics</span>
<span class="sd">    field_name : str</span>
<span class="sd">        The name of the field</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>
<span class="sd">    rad1_name, rad2_name : str</span>
<span class="sd">        Name of the radars intercompared</span>
<span class="sd">    rewrite : bool</span>
<span class="sd">        if True a new file is created</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>

    <span class="n">meanbias</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;meanbias&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">medianbias</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;medianbias&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">quant25bias</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;quant25bias&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">quant75bias</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;quant75bias&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">modebias</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;modebias&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;corr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">intercep</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;intercep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">intercep_slope_1</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;intercep_slope_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">nvalues</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start_time_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">start_time</span><span class="p">])</span>
        <span class="n">meanbias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">meanbias</span><span class="p">])</span>
        <span class="n">medianbias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">medianbias</span><span class="p">])</span>
        <span class="n">quant25bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">quant25bias</span><span class="p">])</span>
        <span class="n">quant75bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">quant75bias</span><span class="p">])</span>
        <span class="n">modebias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">modebias</span><span class="p">])</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">corr</span><span class="p">])</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">slope</span><span class="p">])</span>
        <span class="n">intercep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">intercep</span><span class="p">])</span>
        <span class="n">intercep_slope_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">intercep_slope_1</span><span class="p">])</span>
        <span class="n">np_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;npoints&#39;</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_time_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
        <span class="n">np_t</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;npoints&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span>
        <span class="n">file_exists</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="n">file_exists</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_exists</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_exists</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EAGAIN</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;# Weather radar intercomparison scores timeseries file</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Description: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Time series of the intercomparison between two radars.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Radar 1: &#39;</span><span class="o">+</span><span class="n">rad1_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Radar 2: &#39;</span><span class="o">+</span><span class="n">rad2_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Field name: &#39;</span><span class="o">+</span><span class="n">field_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Fill Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;# Start: &#39;</span><span class="o">+</span><span class="n">start_time_aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                    <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;median_bias&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;quant25_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;quant75_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;mode_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;corr&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;slope_of_linear_regression&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;intercep_of_linear_regression&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;intercep_of_linear_regression_of_slope_1&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">start_time_aux</span><span class="p">):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;NP&#39;</span><span class="p">:</span> <span class="n">np_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;mean_bias&#39;</span><span class="p">:</span> <span class="n">meanbias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;median_bias&#39;</span><span class="p">:</span> <span class="n">medianbias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;quant25_bias&#39;</span><span class="p">:</span> <span class="n">quant25bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;quant75_bias&#39;</span><span class="p">:</span> <span class="n">quant75bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;mode_bias&#39;</span><span class="p">:</span> <span class="n">modebias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;corr&#39;</span><span class="p">:</span> <span class="n">corr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;slope_of_linear_regression&#39;</span><span class="p">:</span> <span class="n">slope</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;intercep_of_linear_regression&#39;</span><span class="p">:</span> <span class="n">intercep</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;intercep_of_linear_regression_of_slope_1&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">intercep_slope_1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="p">})</span>

            <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EAGAIN</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;median_bias&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;quant25_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;quant75_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;mode_bias&#39;</span><span class="p">,</span> <span class="s1">&#39;corr&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;slope_of_linear_regression&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;intercep_of_linear_regression&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;intercep_of_linear_regression_of_slope_1&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">start_time_aux</span><span class="p">):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;NP&#39;</span><span class="p">:</span> <span class="n">np_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;mean_bias&#39;</span><span class="p">:</span> <span class="n">meanbias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;median_bias&#39;</span><span class="p">:</span> <span class="n">medianbias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;quant25_bias&#39;</span><span class="p">:</span> <span class="n">quant25bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;quant75_bias&#39;</span><span class="p">:</span> <span class="n">quant75bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;mode_bias&#39;</span><span class="p">:</span> <span class="n">modebias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;corr&#39;</span><span class="p">:</span> <span class="n">corr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;slope_of_linear_regression&#39;</span><span class="p">:</span> <span class="n">slope</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;intercep_of_linear_regression&#39;</span><span class="p">:</span> <span class="n">intercep</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;intercep_of_linear_regression_of_slope_1&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">intercep_slope_1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="p">})</span>
            <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_colocated_gates"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_colocated_gates">[docs]</a><span class="k">def</span> <span class="nf">write_colocated_gates</span><span class="p">(</span><span class="n">coloc_gates</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the position of gates colocated with two radars</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coloc_gates : dict</span>
<span class="sd">        dictionary containing the colocated gates parameters</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Colocated radar gates data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ele&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_ele&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng&#39;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rad1_ray_ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">]):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">:</span> <span class="n">rad1_ray_ind</span><span class="p">,</span>
                <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad1_ele&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad1_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad1_azi&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad1_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad1_rng&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad1_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad2_ele&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad2_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad2_azi&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad2_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;rad2_rng&#39;</span><span class="p">:</span> <span class="n">coloc_gates</span><span class="p">[</span><span class="s1">&#39;rad2_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>

        <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_colocated_data"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_colocated_data">[docs]</a><span class="k">def</span> <span class="nf">write_colocated_data</span><span class="p">(</span><span class="n">coloc_data</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the data of gates colocated with two radars</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coloc_data : dict</span>
<span class="sd">        dictionary containing the colocated data parameters</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Colocated radar gates data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;rad1_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ele&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad1_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_val&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_ele&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_azi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_val&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rad1_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_time&#39;</span><span class="p">]):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;rad1_time&#39;</span><span class="p">:</span> <span class="n">rad1_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_val&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_val&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_time&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_val&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_val&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;rad1_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ele&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad1_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_val&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_ele&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_azi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_val&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rad1_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_time&#39;</span><span class="p">]):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;rad1_time&#39;</span><span class="p">:</span> <span class="n">rad1_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_val&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_val&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_time&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_val&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_val&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_colocated_data_time_avg"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_colocated_data_time_avg">[docs]</a><span class="k">def</span> <span class="nf">write_colocated_data_time_avg</span><span class="p">(</span><span class="n">coloc_data</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the time averaged data of gates colocated with two radars</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coloc_data : dict</span>
<span class="sd">        dictionary containing the colocated data parameters</span>
<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Colocated radar gates data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;rad1_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ele&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad1_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_dBZavg&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_PhiDPavg&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad1_Flagavg&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_ele&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_dBZavg&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_PhiDPavg&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_Flagavg&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rad1_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_time&#39;</span><span class="p">]):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;rad1_time&#39;</span><span class="p">:</span> <span class="n">rad1_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_dBZavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_dBZavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_PhiDPavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_PhiDPavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_Flagavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_Flagavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_time&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_dBZavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_dBZavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_PhiDPavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_PhiDPavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_Flagavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_Flagavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>

            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;rad1_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_ele&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad1_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_dBZavg&#39;</span><span class="p">,</span> <span class="s1">&#39;rad1_PhiDPavg&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad1_Flagavg&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_time&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_ele&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_azi&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_rng&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_dBZavg&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad2_PhiDPavg&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2_Flagavg&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rad1_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_time&#39;</span><span class="p">]):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;rad1_time&#39;</span><span class="p">:</span> <span class="n">rad1_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_dBZavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_dBZavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_PhiDPavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_PhiDPavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad1_Flagavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad1_Flagavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_time&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ray_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng_ind&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_ele&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_ele&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_azi&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_azi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_rng&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_rng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_dBZavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_dBZavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_PhiDPavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_PhiDPavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad2_Flagavg&#39;</span><span class="p">:</span> <span class="n">coloc_data</span><span class="p">[</span><span class="s1">&#39;rad2_Flagavg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_sun_hits"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_sun_hits">[docs]</a><span class="k">def</span> <span class="nf">write_sun_hits</span><span class="p">(</span><span class="n">sun_hits</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes sun hits data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sun_hits : dict</span>
<span class="sd">        dictionary containing the sun hits parameters</span>

<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dBm_sun_hit</span> <span class="o">=</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;dBm_sun_hit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">std_dBm_sun_hit</span> <span class="o">=</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;std(dBm_sun_hit)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">dBmv_sun_hit</span> <span class="o">=</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;dBmv_sun_hit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">std_dBmv_sun_hit</span> <span class="o">=</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;std(dBmv_sun_hit)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">zdr_sun_hit</span> <span class="o">=</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;ZDR_sun_hit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">std_zdr_sun_hit</span> <span class="o">=</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;std(ZDR_sun_hit)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>

    <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Weather radar sun hits data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Fill Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;ray&#39;</span><span class="p">,</span> <span class="s1">&#39;NPrng&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad_el&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_az&#39;</span><span class="p">,</span> <span class="s1">&#39;sun_el&#39;</span><span class="p">,</span> <span class="s1">&#39;sun_az&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dBm_sun_hit&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBm_sun_hit)&#39;</span><span class="p">,</span> <span class="s1">&#39;NPh&#39;</span><span class="p">,</span> <span class="s1">&#39;NPhval&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dBmv_sun_hit&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBmv_sun_hit)&#39;</span><span class="p">,</span> <span class="s1">&#39;NPv&#39;</span><span class="p">,</span> <span class="s1">&#39;NPvval&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ZDR_sun_hit&#39;</span><span class="p">,</span> <span class="s1">&#39;std(ZDR_sun_hit)&#39;</span><span class="p">,</span> <span class="s1">&#39;NPzdr&#39;</span><span class="p">,</span> <span class="s1">&#39;NPzdrval&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">sh_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;ray&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;ray&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPrng&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPrng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad_el&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;rad_el&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad_az&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;rad_az&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;sun_el&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;sun_el&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;sun_az&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;sun_az&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;dBm_sun_hit&#39;</span><span class="p">:</span> <span class="n">dBm_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;std(dBm_sun_hit)&#39;</span><span class="p">:</span> <span class="n">std_dBm_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPh&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPh&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPhval&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPhval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;dBmv_sun_hit&#39;</span><span class="p">:</span> <span class="n">dBmv_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;std(dBmv_sun_hit)&#39;</span><span class="p">:</span> <span class="n">std_dBmv_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPv&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPv&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPvval&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPvval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ZDR_sun_hit&#39;</span><span class="p">:</span> <span class="n">zdr_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;std(ZDR_sun_hit)&#39;</span><span class="p">:</span> <span class="n">std_zdr_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPzdr&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPzdr&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPzdrval&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPzdrval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;ray&#39;</span><span class="p">,</span> <span class="s1">&#39;NPrng&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rad_el&#39;</span><span class="p">,</span> <span class="s1">&#39;rad_az&#39;</span><span class="p">,</span> <span class="s1">&#39;sun_el&#39;</span><span class="p">,</span> <span class="s1">&#39;sun_az&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dBm_sun_hit&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBm_sun_hit)&#39;</span><span class="p">,</span> <span class="s1">&#39;NPh&#39;</span><span class="p">,</span> <span class="s1">&#39;NPhval&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dBmv_sun_hit&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBmv_sun_hit)&#39;</span><span class="p">,</span> <span class="s1">&#39;NPv&#39;</span><span class="p">,</span> <span class="s1">&#39;NPvval&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ZDR_sun_hit&#39;</span><span class="p">,</span> <span class="s1">&#39;std(ZDR_sun_hit)&#39;</span><span class="p">,</span> <span class="s1">&#39;NPzdr&#39;</span><span class="p">,</span> <span class="s1">&#39;NPzdrval&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sh_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span>
                    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">sh_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;ray&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;ray&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPrng&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPrng&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad_el&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;rad_el&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;rad_az&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;rad_az&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;sun_el&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;sun_el&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;sun_az&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;sun_az&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;dBm_sun_hit&#39;</span><span class="p">:</span> <span class="n">dBm_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;std(dBm_sun_hit)&#39;</span><span class="p">:</span> <span class="n">std_dBm_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPh&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPh&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPhval&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPhval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;dBmv_sun_hit&#39;</span><span class="p">:</span> <span class="n">dBmv_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;std(dBmv_sun_hit)&#39;</span><span class="p">:</span> <span class="n">std_dBmv_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPv&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPv&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPvval&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPvval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;ZDR_sun_hit&#39;</span><span class="p">:</span> <span class="n">zdr_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;std(ZDR_sun_hit)&#39;</span><span class="p">:</span> <span class="n">std_zdr_sun_hit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPzdr&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPzdr&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;NPzdrval&#39;</span><span class="p">:</span> <span class="n">sun_hits</span><span class="p">[</span><span class="s1">&#39;NPzdrval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="write_sun_retrieval"><a class="viewcode-back" href="../../../io.html#pyrad.io.write_sun_retrieval">[docs]</a><span class="k">def</span> <span class="nf">write_sun_retrieval</span><span class="p">(</span><span class="n">sun_retrieval</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes sun retrieval data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sun_retrieval : dict</span>
<span class="sd">        dictionary containing the sun retrieval parameters</span>

<span class="sd">    fname : str</span>
<span class="sd">        file name where to store the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the name of the file where data has written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_hit_time</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;first_hit_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>
    <span class="n">last_hit_time</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;last_hit_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>
    <span class="n">el_width_h</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;el_width_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">az_width_h</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;az_width_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">el_bias_h</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;el_bias_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">az_bias_h</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;az_bias_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">dBm_sun_est</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;dBm_sun_est&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">std_dBm_sun_est</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;std(dBm_sun_est)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">sf_h</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;sf_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>

    <span class="n">el_width_v</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;el_width_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">az_width_v</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;az_width_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">el_bias_v</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;el_bias_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">az_bias_v</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;az_bias_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">dBmv_sun_est</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;dBmv_sun_est&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">std_dBmv_sun_est</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;std(dBmv_sun_est)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">sf_v</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;sf_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>

    <span class="n">zdr_sun_est</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;ZDR_sun_est&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">std_zdr_sun_est</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;std(ZDR_sun_est)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">sf_ref</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;sf_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">get_fillvalue</span><span class="p">())</span>
    <span class="n">ref_time</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
    <span class="k">if</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;ref_time&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref_time</span> <span class="o">=</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;ref_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>

    <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Weather radar sun retrievals data file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Comment lines are preceded by &quot;#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Fill Value: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">get_fillvalue</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;first_hit_time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_hit_time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nhits_h&#39;</span><span class="p">,</span> <span class="s1">&#39;el_width_h&#39;</span><span class="p">,</span> <span class="s1">&#39;az_width_h&#39;</span><span class="p">,</span>
                <span class="s1">&#39;el_bias_h&#39;</span><span class="p">,</span> <span class="s1">&#39;az_bias_h&#39;</span><span class="p">,</span> <span class="s1">&#39;dBm_sun_est&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBm_sun_est)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;sf_h&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nhits_v&#39;</span><span class="p">,</span> <span class="s1">&#39;el_width_v&#39;</span><span class="p">,</span> <span class="s1">&#39;az_width_v&#39;</span><span class="p">,</span>
                <span class="s1">&#39;el_bias_v&#39;</span><span class="p">,</span> <span class="s1">&#39;az_bias_v&#39;</span><span class="p">,</span> <span class="s1">&#39;dBmv_sun_est&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBmv_sun_est)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;sf_v&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nhits_zdr&#39;</span><span class="p">,</span> <span class="s1">&#39;ZDR_sun_est&#39;</span><span class="p">,</span> <span class="s1">&#39;std(ZDR_sun_est)&#39;</span><span class="p">,</span> <span class="s1">&#39;sf_ref&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ref_time&#39;</span><span class="p">]</span>

            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;first_hit_time&#39;</span><span class="p">:</span> <span class="n">first_hit_time</span><span class="p">,</span>
                 <span class="s1">&#39;last_hit_time&#39;</span><span class="p">:</span> <span class="n">last_hit_time</span><span class="p">,</span>
                 <span class="s1">&#39;nhits_h&#39;</span><span class="p">:</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;nhits_h&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;el_width_h&#39;</span><span class="p">:</span> <span class="n">el_width_h</span><span class="p">,</span>
                 <span class="s1">&#39;az_width_h&#39;</span><span class="p">:</span> <span class="n">az_width_h</span><span class="p">,</span>
                 <span class="s1">&#39;el_bias_h&#39;</span><span class="p">:</span> <span class="n">el_bias_h</span><span class="p">,</span>
                 <span class="s1">&#39;az_bias_h&#39;</span><span class="p">:</span> <span class="n">az_bias_h</span><span class="p">,</span>
                 <span class="s1">&#39;dBm_sun_est&#39;</span><span class="p">:</span> <span class="n">dBm_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;std(dBm_sun_est)&#39;</span><span class="p">:</span> <span class="n">std_dBm_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;sf_h&#39;</span><span class="p">:</span> <span class="n">sf_h</span><span class="p">,</span>
                 <span class="s1">&#39;nhits_v&#39;</span><span class="p">:</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;nhits_v&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;el_width_v&#39;</span><span class="p">:</span> <span class="n">el_width_v</span><span class="p">,</span>
                 <span class="s1">&#39;az_width_v&#39;</span><span class="p">:</span> <span class="n">az_width_v</span><span class="p">,</span>
                 <span class="s1">&#39;el_bias_v&#39;</span><span class="p">:</span> <span class="n">el_bias_v</span><span class="p">,</span>
                 <span class="s1">&#39;az_bias_v&#39;</span><span class="p">:</span> <span class="n">az_bias_v</span><span class="p">,</span>
                 <span class="s1">&#39;dBmv_sun_est&#39;</span><span class="p">:</span> <span class="n">dBmv_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;std(dBmv_sun_est)&#39;</span><span class="p">:</span> <span class="n">std_dBmv_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;sf_v&#39;</span><span class="p">:</span> <span class="n">sf_v</span><span class="p">,</span>
                 <span class="s1">&#39;nhits_zdr&#39;</span><span class="p">:</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;nhits_zdr&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;ZDR_sun_est&#39;</span><span class="p">:</span> <span class="n">zdr_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;std(ZDR_sun_est)&#39;</span><span class="p">:</span> <span class="n">std_zdr_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;sf_ref&#39;</span><span class="p">:</span> <span class="n">sf_ref</span><span class="p">,</span>
                 <span class="s1">&#39;ref_time&#39;</span><span class="p">:</span> <span class="n">ref_time</span><span class="p">})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;first_hit_time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_hit_time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nhits_h&#39;</span><span class="p">,</span> <span class="s1">&#39;el_width_h&#39;</span><span class="p">,</span> <span class="s1">&#39;az_width_h&#39;</span><span class="p">,</span>
                <span class="s1">&#39;el_bias_h&#39;</span><span class="p">,</span> <span class="s1">&#39;az_bias_h&#39;</span><span class="p">,</span> <span class="s1">&#39;dBm_sun_est&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBm_sun_est)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;sf_h&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nhits_v&#39;</span><span class="p">,</span> <span class="s1">&#39;el_width_v&#39;</span><span class="p">,</span> <span class="s1">&#39;az_width_v&#39;</span><span class="p">,</span>
                <span class="s1">&#39;el_bias_v&#39;</span><span class="p">,</span> <span class="s1">&#39;az_bias_v&#39;</span><span class="p">,</span> <span class="s1">&#39;dBmv_sun_est&#39;</span><span class="p">,</span> <span class="s1">&#39;std(dBmv_sun_est)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;sf_v&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nhits_zdr&#39;</span><span class="p">,</span> <span class="s1">&#39;ZDR_sun_est&#39;</span><span class="p">,</span> <span class="s1">&#39;std(ZDR_sun_est)&#39;</span><span class="p">,</span> <span class="s1">&#39;sf_ref&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ref_time&#39;</span><span class="p">]</span>

            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;first_hit_time&#39;</span><span class="p">:</span> <span class="n">first_hit_time</span><span class="p">,</span>
                 <span class="s1">&#39;last_hit_time&#39;</span><span class="p">:</span> <span class="n">last_hit_time</span><span class="p">,</span>
                 <span class="s1">&#39;nhits_h&#39;</span><span class="p">:</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;nhits_h&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;el_width_h&#39;</span><span class="p">:</span> <span class="n">el_width_h</span><span class="p">,</span>
                 <span class="s1">&#39;az_width_h&#39;</span><span class="p">:</span> <span class="n">az_width_h</span><span class="p">,</span>
                 <span class="s1">&#39;el_bias_h&#39;</span><span class="p">:</span> <span class="n">el_bias_h</span><span class="p">,</span>
                 <span class="s1">&#39;az_bias_h&#39;</span><span class="p">:</span> <span class="n">az_bias_h</span><span class="p">,</span>
                 <span class="s1">&#39;dBm_sun_est&#39;</span><span class="p">:</span> <span class="n">dBm_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;std(dBm_sun_est)&#39;</span><span class="p">:</span> <span class="n">std_dBm_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;sf_h&#39;</span><span class="p">:</span> <span class="n">sf_h</span><span class="p">,</span>
                 <span class="s1">&#39;nhits_v&#39;</span><span class="p">:</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;nhits_v&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;el_width_v&#39;</span><span class="p">:</span> <span class="n">el_width_v</span><span class="p">,</span>
                 <span class="s1">&#39;az_width_v&#39;</span><span class="p">:</span> <span class="n">az_width_v</span><span class="p">,</span>
                 <span class="s1">&#39;el_bias_v&#39;</span><span class="p">:</span> <span class="n">el_bias_v</span><span class="p">,</span>
                 <span class="s1">&#39;az_bias_v&#39;</span><span class="p">:</span> <span class="n">az_bias_v</span><span class="p">,</span>
                 <span class="s1">&#39;dBmv_sun_est&#39;</span><span class="p">:</span> <span class="n">dBmv_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;std(dBmv_sun_est)&#39;</span><span class="p">:</span> <span class="n">std_dBmv_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;sf_v&#39;</span><span class="p">:</span> <span class="n">sf_v</span><span class="p">,</span>
                 <span class="s1">&#39;nhits_zdr&#39;</span><span class="p">:</span> <span class="n">sun_retrieval</span><span class="p">[</span><span class="s1">&#39;nhits_zdr&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;ZDR_sun_est&#39;</span><span class="p">:</span> <span class="n">zdr_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;std(ZDR_sun_est)&#39;</span><span class="p">:</span> <span class="n">std_zdr_sun_est</span><span class="p">,</span>
                 <span class="s1">&#39;sf_ref&#39;</span><span class="p">:</span> <span class="n">sf_ref</span><span class="p">,</span>
                 <span class="s1">&#39;ref_time&#39;</span><span class="p">:</span> <span class="n">ref_time</span><span class="p">})</span>
            <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fname</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pyrad 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, meteoswiss-mdr.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>